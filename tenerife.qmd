---
title: "Anàlisi Exploratòria Lleres Tenerife"
author: "Miquel Àngel Aguiló, Joan Camps, Gerard Ribas"
format: html
lang: ca
---

```{css, echo=FALSE}
/* Estil de sortida per HTML/CSS */
/* Per posar notes pròpies */
todo {color: magenta}
gra {color: rgb(237, 65, 65)}
jct {color: #6666ff}
maa {color: #66bb66}
note {color: orange}
comment {display: none}
gra::before {
   content: "[G: ";
   font-weight: bold;
}
jct::before {
   content: "[J: ";
   font-weight: bold;
}
maa::before {
   content: "[M: ";
   font-weight: bold;
}
note::before {
   content: "[NOTA: ";
   font-weight: bold;
}
todo::before {
   content: "[TODO: ";
   font-weight: bold;
}
gra::after, jct::after, note::after, todo::after, maa:after {
   content: "]";
}
```

```{r, echo=FALSE, include=FALSE}
library(tidyverse)
library(ggplot2)
```


# Introducció i objectiu

blablabla. Idea: comprovar si les longituds 2d i 3d segueixen la mateixa distribució

<gra>Comentari Gerard</gra>

<jct>Comentari Joan</jct>

<maa>Comentari Miki</maa>

<todo>un TODO</todo>

# Anàlisi exploratòria

## Càrrega de dades

Carreguem el CSV a R, i comecem comentant les dades que hi apareixen.

```{r}
rius = read.csv("inventario-insular-de-cauces-de-tenerife.csv")
str(rius)
```

Es pot consultar [aquesta web](https://datos.tenerife.es/es/datos/tablero?resourceId=f630dd85-9e4f-45f6-8bd4-212924a8a0b0) per entendre les variables.

Les dades tracten sobre lleres de l'illa de Tenerife. Les variables que es contemplen són les que segueixen:

-   **cauce_id**: de tipus qualitatiu, nombre que identifica unívocament cada una de les lleres registrades a l'illa.

-   **cauce_toponimos**: de tipus qualitatiu, es refereix al nom donat a la llera.

-   **cacue_alonimos**: de tipus qualitatiu, es refereix a una possible variant del nom expressat a la variable anterior per referir-se a la mateixa llera.

-   **cauce_nivel**: de tipus ordinal, s'utilitza per identificar i ordenar les diferents bifurcacions d'una mateixa llera segons el grau d'importància. El nivell 1 indica una llera principal, i nivells superiors són afluents dels nivells anteriors.

-   **cauce_orden**: de tipus ordinal, s'utilitza per ordenar les afluents d'una llera respecte del nivells anteriors. Un nombre '1xy' de nivell 3 indica que és l'afluent y de l'afluent x de la llera principal. En l'[Inventario oficial de cauces de la Demarcación Hidrpgráfica de Tenerife](https://www.aguastenerife.org/images/pdf/PHT1erCiclo/III-DocumentoGestionGobernanza/III-1-Normativa/III-1-2-Anejos/III-1-2-Anejo4-InventarioCauces.pdf) es pot consultar la jerarquia de totes les lleres.

Per exemple, si una llera té nivell 1 (amb identificador 3, per exemple) vol dir que és un dels rius (el tercer identificat) principals de la conca; els que tenguin nivell 2 i l'identificador 31, 32, ..., 39, 3A són les bifurcacions d'aquella llera. Aquestes poden tenir altres bifurcacions, que serien de nivell 3 i per exemple 311, 312, ...

- **cauce_longitud_2d**: de tipus quantitatiu continu, és la mesura de la longitud de la llera en metres si fos mesurat sobre un mapa.

- **cauce_longitud_3d**: de tipus quantitatiu continu, és la mesura de la longitud real del riu tenint en compte l'altitud (mesurat sobre un model digital del terreny).

- **cuenca_principal_id**: de tipus qualitatiu, és un identificador de les conques de l'illa. Totes les lleres que desenboquen en una mateixa conca formen una xarxa.

- **cauce_nombre_phi**: de tipus qualitatiu, és el nom de llera que consta en el PHI (Plan Hidrológico Insular)

- **cauce_rotulo_phi**: de tipus qualitatiu, és el ròtul o nom que s'empra a la pràctica per etiquetar cada llera en el PHI.

## Longituds en 2D i en 3D globals

<todo> afegir llegenda, arreglar títols gràfiques, ... </todo>

Mostrem la distribució de les longituds en metres en 2D i en 3D superposades en un mateix gràfic.

```{r}
plot(density(rius$cauce_longitud_2d), col = "blue")
lines(density(rius$cauce_longitud_3d), col = "red")
```

Com que hi ha molt pocs rius que arribin al quilòmetre de llargària, visualitzarem millor la densitat si ens restringim a aquestes lleres.

```{r}
sprintf("Rius de menys d'1km (en 2d): %d", sum(rius$cauce_longitud_2d < 1000))
plot(density(rius$cauce_longitud_2d), col = "blue", xlim = c(0, 1000))
lines(density(rius$cauce_longitud_3d), col = "red")
```

Vegem en un diagrama de barres les longituds 2d i 3d acumulades en les lleres que arriben a les conques principals. Entendrem per principals aquelles conques amb nom amb més lleres que hi desenboquen.
```{r}
#Agrupam per nombre de conca, i acumulam valors de longituds
df_2 <- rius %>%
    group_by(cuenca_principal_id) %>%
    summarise(cauce_longitud_2d=sum(cauce_longitud_2d), cauce_longitud_3d=sum(cauce_longitud_3d), count = n())
#només ens quedam amb les 4 conques amb més lleres
df_2 = df_2[order(df_2$count,decreasing=TRUE, na.last=FALSE),]
df_2=df_2[1:4,]

#Feim els diagrames de barres

# Reshape the data for easier plotting
df_long <- df %>%
  pivot_longer(cols = c(cauce_longitud_2d, cauce_longitud_2d), names_to = "variable", values_to = "value")

# Create the bar plot
ggplot(df_long, aes(x = Row, y = value, fill = variable)) +
  geom_bar(stat = 'identity', position = 'dodge') +
  labs(x = 'Row', y = 'Values', title = 'Bar Graph of Column2 and Column3 for Each Row') +
  scale_fill_manual(values = c('Column2' = 'blue', 'Column3' = 'green'))